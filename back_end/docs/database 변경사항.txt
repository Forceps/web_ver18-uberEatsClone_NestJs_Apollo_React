CREATE SCHEMA nuber_eats;

CREATE TABLE nuber_eats.restaurant (
  restaurant_id int unsigned NOT NULL AUTO_INCREMENT,
  name varchar(45) NOT NULL,
  isVegan tinyint NOT NULL,
  address varchar(45) NOT NULL,
  ownerName varchar(45) NOT NULL,
  categoryName varchar(45) NOT NULL,
  PRIMARY KEY (restaurant_id)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

ALTER TABLE nuber_eats.restaurant 
CHANGE COLUMN isVegan isVegan TINYINT NULL ;

CREATE TABLE `nuber_eats`.`user` (
  `id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `createdAt` datetime DEFAULT NULL,
  `updatedAt` datetime DEFAULT NULL,
  `email` varchar(80) NOT NULL,
  `password` varchar(70) NOT NULL,
  `role` enum('client','owner','delivery') NOT NULL DEFAULT 'client',
  PRIMARY KEY (`id`),
  UNIQUE KEY `email_UNIQUE` (`email`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

ALTER TABLE `nuber_eats`.`user` 
ADD COLUMN `verified` TINYINT UNSIGNED NOT NULL DEFAULT 0 AFTER `email`;

CREATE TABLE `nuber_eats`.`verification` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  `createdAt` DATETIME NULL,
  `updatedAt` DATETIME NULL,
  `code` VARCHAR(45) NOT NULL,
  `userId` BIGINT UNSIGNED NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `userId_UNIQUE` (`userId` ASC) VISIBLE,
  CONSTRAINT `userId_to_verification`
    FOREIGN KEY (`userId`)
    REFERENCES `nuber_eats`.`user` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE);
ALTER TABLE `nuber_eats`.`verification` 
CHANGE COLUMN `code` `code` VARCHAR(25) NOT NULL ;

